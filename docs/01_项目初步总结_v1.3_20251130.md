# 项目初步总结

> **文档版本**: v1.3  
> **创建时间**: 2025-11-30 12:49  
> **最后更新时间**: 2025-11-30 20:05  
> **作者**: Carbon-Aware Building Control Team  
> **状态**: ✅ v1.3 模型验证通过，RL-Ready

---

## 1. 项目概述

### 1.1 项目名称

**基于深度强化学习的建筑能源碳感知控制系统**  
*Carbon-Aware Building Control with Deep Reinforcement Learning*

### 1.2 项目背景

本项目旨在复现并扩展论文《Deep reinforcement learning-based control of thermal energy storage for university classrooms》的研究成果，并结合中国"双碳"目标进行创新。

### 1.3 核心目标

| 目标 | 描述 | v1.3 状态 |
|-----|------|----------|
| **复现** | 实现论文中的 SAC 强化学习控制热储能系统 | ✅ 框架完成 |
| **升级** | 使用 EnergyPlus + Sinergym 替代 TRNSYS 进行高保真仿真 | ✅ 模型验证通过 |
| **创新** | 引入碳排放双目标优化 (Innovation B) | ✅ Wrapper 完成 |
| **扩展** | 使用 Transformer 架构提取时序特征 (Innovation C) | ✅ Gym Wrapper 完成 |

---

## 2. v1.3 重大更新

### 2.1 模型验证与修复

| 修复项 | 问题描述 | 解决方案 |
|--------|----------|----------|
| **节点拓扑** | TES 串联连接导致 Severe Error | 引入中间节点 `HP_Outlet_TES_Inlet` |
| **SetpointManager** | 新旧管理器冲突 | 删除原模板管理器后创建 RL 专用 |
| **输出变量名** | EnergyPlus 23.x 格式变化 | 从 `.rdd` 文件校正变量名 |
| **NaturalGas Meters** | 全电气化后无效 | 自动清理燃气计量表 |
| **TES 变量残留** | 升级 Stratified 后旧变量存在 | 同步删除旧 `TES_Tank` 输出 |

### 2.2 仿真验证结果

```
┌─────────────────────────────────────────────────────┐
│  EnergyPlus Completed Successfully                  │
│  Warnings: 1 (Feb29 闰年，不影响结果)               │
│  Severe Errors: 0                                   │
│  Fatal Errors: 0                                    │
└─────────────────────────────────────────────────────┘
```

**年度能源指标**:
- 总电力需求: 47.59 MWh
- 净购电量: 17.07 MWh
- PV 发电量: 31.79 MWh
- **自消费率: 64.1%**

### 2.3 物理模型配置 (继承 v1.2)

| 组件 | 配置 | 物理意义 |
|------|------|----------|
| **热泵** | `HeatPump:PlantLoop:EIR:Heating` 195.8 kW | 真实 LWT/OAT 温度依赖 |
| **热水 TES** | `WaterHeater:Stratified` 12m³, 10节点 | 热跃层建模，SOC 观测 |
| **冷水 TES** | `WaterHeater:Stratified` 8m³, 6节点 | 分层蓄冷，除湿能力 |
| **热损系数** | HW: 15 W/K, CW: 8 W/K | 50mm 聚氨酯保温 |
| **PV 系统** | 47 kW 峰值, 18% 效率 | 屋顶光伏发电 |

---

## 3. 代码架构

```
project/
├── envs/
│   ├── builder.py          # IDF 模型构建器 (v1.3 修复)
│   ├── gym_wrapper.py      # Gymnasium 环境封装
│   └── __init__.py         # 模块导出
├── tools/
│   ├── freeze_model.py     # 自动尺寸固化
│   └── check_results.py    # 仿真健康检查 (v1.3 新增)
├── outputs/
│   ├── sim_building.idf    # 生成的 IDF 模型
│   └── sizing_run/         # 仿真输出目录
└── data/
    ├── templates/          # EnergyPlus 模板
    └── weather/            # 气象数据 (Shanghai_2024.epw)
```

---

## 4. 下一阶段目标

1. **完善 Gymnasium 环境**: 集成 EnergyPlus Python API
2. **实现 RL 训练脚本**: SAC + Transformer 特征提取
3. **碳排放数据准备**: 上海电网实时碳强度
4. **基线控制器实现**: Rule-Based, MLP-SAC, Random

---

## 5. 参考文献

1. Ding, Z., et al. (2024). Deep reinforcement learning-based control of thermal energy storage. *Applied Energy*
2. EnergyPlus 23.2 Documentation - Input Output Reference
3. ASHRAE Handbook - HVAC Systems and Equipment, Chapter 25
